# Logging & Monitoring Service

Сервис для приёма, хранения и агрегации логов через gRPC API. Проект реализует функционал для отправки логов, их запроса по фильтрам и стриминга в реальном времени. Предоставляются два варианта реализации: базовый (с хранением в памяти) и расширенный (с использованием SQLite для персистентности).

## Описание проекта
Сервис предназначен для мониторинга и логирования приложений. Он поддерживает:
- Отправку логов через метод `SendLog`.
- Запрос логов по фильтрам (сервис, уровень) через `QueryLogs`.
- Стриминг существующих логов через `StreamLogs`.

## Сценарии использования
- Мониторинг веб-серверов: Отслеживание ошибок и успешных запросов.
- Анализ логов в реальном времени: Использование стриминга для отладки.
- Хранение логов: Использование SQLite для сохранения данных между запусками.

## Системные требования
- **Python**: Версия 3.9 или новее (рекомендуется 3.11).
- **Операционная система**: Windows, Linux или macOS.
- **Для SQLite-версии**: Не требуется установка дополнительных библиотек, так как `sqlite3` встроен в Python.

## Установка

### 1. Установка Python
- Убедись, что Python 3.9+ установлен. Проверь версию:
  ```bash
  python3 --version
  ```
- Скачай Python с [официального сайта](https://www.python.org/downloads/), если он не установлен.

### 2. Установка зависимостей
- Установи необходимые пакеты:
  ```bash
  pip install grpcio grpcio-tools
  ```
  - `grpcio`: Основная библиотека для работы с gRPC.
  - `grpcio-tools`: Инструменты для генерации кода из `.proto` файлов.

### 3. Настройка проекта
- Убедись, что структура проекта сохранена:
  ```
  LoggingService/
  ├── proto/                # Описание сервиса в .proto файле
  │   └── logging.proto
  ├── server/               # Логика сервера
  │   └── server.py         # Базовый вариант (in-memory)
  │   └── server_sqlite.py  # Расширенный вариант (SQLite)
  ├── client/               # Клиент для тестирования
  │   └── client.py
  ├── data/                 # Файлы базы данных и схемы
  │   └── database.sqlite   # Файл базы данных (создаётся автоматически)
  │   └── schema.sql        # Схема таблицы
  ├── README.md             # Документация
  ```

### 4. Генерация кода из `.proto`
- Выполни команду для генерации Python-кода из файла `logging.proto`:
  ```bash
  python -m grpc_tools.protoc -I proto --python_out=. --grpc_python_out=. proto/logging.proto
  ```
  - **Пояснение**:
    - `-I proto`: Указывает директорию, где находятся `.proto` файлы, из которой будет загружен файл `logging.proto`.
    - `--python_out=.`: Указывает, что сгенерированный Python-код будет сохранён в текущую директорию (`.`) относительно места выполнения команды.
    - `--grpc_python_out=.`: Указывает, что будет сгенерирован дополнительный файл `logging_pb2_grpc.py`, содержащий gRPC-методы, и он также будет сохранён в текущую директорию.
    - `proto/logging.proto`: Путь к файлу с определением сервиса и сообщений в формате Protocol Buffers.
  - После выполнения команды убедись, что файлы `logging_pb2.py` и `logging_pb2_grpc.py` созданы в корне проекта. Эти файлы необходимы для работы клиента и сервера.

## Запуск

### Базовый вариант (in-memory)
1. Запусти сервер:
   ```bash
   python server/server.py
   ```
   - Сервер будет работать на порту 50051. Убедись, что порт свободен, иначе заверши другие процессы, использующие его.
2. Запусти клиент для тестирования:
   ```bash
   python client/client.py
   ```
   Ожидаемый вывод:
     ```
     Тест SendLog:
     Лог отправлен
     Лог отправлен
     Лог отправлен

     Тест QueryLogs:
     Полученные логи:
     web - INFO - Страница загружена - <timestamp>

     Тест StreamLogs:
     Получение потока логов:
     web - INFO - Страница загружена - <timestamp>
     web - ERROR - Ошибка 500 - <timestamp>
     ```

### Расширенный вариант (SQLite)
1. Запусти сервер с SQLite:
   ```bash
   python server/server_sqlite.py
   ```
   - Сервер создаст файл `data/database.sqlite` и таблицу `logs`. Убедись, что порт 50051 свободен.
2. Запусти клиент:
   ```bash
   python client/client.py
   ```
   Ожидаемый вывод:
     ```
     Тест SendLog:
     Лог отправлен
     Лог отправлен
     Лог отправлен

     Тест QueryLogs:
     Полученные логи:
     web - INFO - Страница загружена - <timestamp>

     Тест StreamLogs:
     Получение потока логов:
     web - INFO - Страница загружена - <timestamp>
     web - ERROR - Ошибка 500 - <timestamp>
     ```

## Дополнительные ресурсы
- [Документация gRPC](https://grpc.io/docs/)
- [Документация Protocol Buffers](https://developers.google.com/protocol-buffers/docs/proto3)
- [Официальный сайт Python](https://www.python.org/)
